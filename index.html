
<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>City Car Services - Invoice</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root { --primary: #0b5fb4; --accent: #ffda00; --slate: #1e293b; }
        body { 
            font-family: 'Plus Jakarta Sans', 'Noto Sans Devanagari', sans-serif; 
            background: #f1f5f9; padding: 20px 0; 
        }
        
        .a4-wrapper { 
            width: 210mm; min-height: 297mm; margin: 0 auto; 
            background: #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
        }

        /* HEADER REDUCED BY 1 */
        .header-banner { background: var(--primary); color: #fff; }
        .top-info { background: rgba(0,0,0,0.2); padding: 6px 25px; font-size: 13px; display: flex; justify-content: space-between; font-weight: 600; }
        
        /* Balanced Padding */
        .main-header { display: flex; align-items: center; padding: 25px 30px; text-align: center; gap: 20px; }
        
        .logo-box { width: 130px; height: 90px; display: flex; align-items: center; justify-content: center; }
        .logo-box img { max-width: 100%; max-height: 100%; object-fit: contain; }

        .brand-text { flex: 1; }
        .brand-text h1 { font-size: 42px; font-weight: 800; margin: 0; line-height: 1; }
        .marathi-brand { font-size: 24px; font-weight: 700; display: block; margin-top: 2px; color: var(--accent); }
        .address-bar { font-size: 13px; margin-top: 8px; opacity: 0.9; }

        /* FORM ALIGNMENT IMPROVEMENTS */
        #pdfContent { padding: 30px 40px; }
        
        .customer-info-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 20px;
        }

        .form-group { position: relative; }
        .marathi-label { font-size: 13px; color: var(--slate); font-weight: 700; margin-bottom: 4px; display: block; }
        .english-sub { font-size: 10px; color: #64748b; font-weight: 400; text-transform: uppercase; }
        
        .form-control-static { 
            border: 1px solid #cbd5e1; 
            border-radius: 6px; 
            padding: 8px 12px; 
            font-size: 14px; 
            font-weight: 600;
            width: 100%;
        }

        /* TABLE */
        .table-custom thead { background: var(--slate); color: white; }
        .table-custom th { font-size: 11px; padding: 12px !important; border: none; }
        .th-mr { display: block; font-size: 12px; font-weight: 400; color: #cbd5e1; margin-top: 1px; }
        
        .total-box { 
            background: var(--slate); color: white; padding: 20px; 
            border-radius: 8px; width: 320px; margin-left: auto; 
        }

        @media print { .no-print { display: none !important; } .a4-wrapper { box-shadow: none; margin: 0; } }
    </style>
</head>
<body>

<div class="container no-print mb-3 text-center">
    <button class="btn btn-primary px-5 fw-bold" onclick="finalizeAndSave()">
        <i class="fa-solid fa-file-pdf me-2"></i>GENERATE INVOICE / बिल तयार करा
    </button>
</div>

<div class="a4-wrapper" id="printArea">
    <div class="header-banner">
        <div class="top-info">
            <span><i class="fa-solid fa-phone me-1"></i> 8698228740 / 9130172939</span>
            <span class="badge bg-danger px-3">BRANCH-2 / शाखा-२</span>
            <span>Pune, Maharashtra</span>
        </div>
        <div class="main-header">
            <div class="logo-box">
                <img src="https://raw.githubusercontent.com/Studnit/carservice/main/image.png" onerror="this.style.display='none'">
            </div>
            <div class="brand-text">
                <h1>CITY CAR SERVICES</h1>
                <span class="marathi-brand">सिटी कार सर्व्हिसेस</span>
                <div class="address-bar">Radha Chowk, Mahalunge Road, Baner, Pune - 411045</div>
            </div>
            <div class="logo-box">
                <img src="https://raw.githubusercontent.com/Studnit/carservice/main/image.png" onerror="this.style.display='none'">
            </div>
        </div>
    </div>

    <div id="pdfContent">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h6 class="mb-0 fw-800 text-primary">TAX INVOICE</h6>
                <div class="text-muted small" id="currentDate"></div>
            </div>
            <div class="text-end">
                <span class="english-sub">Invoice No / बिल क्र.</span>
                <div class="h4 fw-800 mb-0" id="invoiceIdDisplay">#CCS-1001</div>
            </div>
        </div>

        <div class="customer-info-grid">
            <div class="form-group">
                <label class="marathi-label">ग्राहकाचे नाव <span class="english-sub">(Customer Name)</span></label>
                <input type="text" class="form-control-static" id="custName" placeholder="Full Name">
            </div>
            <div class="form-group">
                <label class="marathi-label">गाडी क्रमांक <span class="english-sub">(Vehicle No)</span></label>
                <input type="text" class="form-control-static text-uppercase" id="vehNo" placeholder="MH 12 XX 0000">
            </div>
            <div class="form-group">
                <label class="marathi-label">संपर्क <span class="english-sub">(Mobile No)</span></label>
                <input type="text" class="form-control-static" id="whatsapp" placeholder="98XXXXXXXX">
            </div>
        </div>

        <table class="table table-custom">
            <thead>
                <tr>
                    <th width="8%">अ.क्र.<span class="th-mr">Sr.No</span></th>
                    <th width="45%">कामाचा तपशील / स्पेअर पार्ट<span class="th-mr">Description of Service/Parts</span></th>
                    <th width="12%" class="text-center">नग<span class="th-mr">Qty</span></th>
                    <th width="15%" class="text-end">दर<span class="th-mr">Rate</span></th>
                    <th width="20%" class="text-end">एकूण<span class="th-mr">Total</span></th>
                </tr>
            </thead>
            <tbody id="itemsBody"></tbody>
        </table>

        <button class="btn btn-sm btn-outline-primary no-print mb-4" onclick="addRow()">
            <i class="fa-solid fa-plus me-1"></i> Add Service Item / नवीन ओळ जोडा
        </button>

        <div class="row mt-4">
            <div class="col-6">
                <div class="border p-3 rounded bg-light" style="font-size: 11px; color: #475569;">
                    <p class="fw-bold mb-1 border-bottom pb-1">अटी आणि शर्ती (Terms & Conditions):</p>
                    <ul class="ps-3 mb-0">
                        <li>Warranty as per manufacturer terms.</li>
                        <li>Payment must be cleared before delivery.</li>
                        <li>All disputes subject to Pune jurisdiction.</li>
                    </ul>
                </div>
            </div>
            <div class="col-6">
                <div class="total-box">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="small">Sub-Total / एकूण</span>
                        <span id="subtotalDisplay">₹0.00</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3 pb-2 border-bottom border-secondary">
                        <span class="small">GST (18%) / जीएसटी</span>
                        <span id="taxDisplay">₹0.00</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="fw-bold">GRAND TOTAL<br><small>एकूण रक्कम</small></span>
                        <span class="h3 fw-800 mb-0" id="grandTotalDisplay" style="color:var(--accent)">₹0.00</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div style="margin-top: 60px;" class="d-flex justify-content-between text-center">
            <div style="width: 160px; border-top: 1px solid #000; padding-top: 5px; font-size: 12px;">
                Customer Signature<br>ग्राहकाची सही
            </div>
            <div style="width: 200px; border-top: 1px solid #000; padding-top: 5px; font-size: 12px;">
                <b>For CITY CAR SERVICES</b><br>Authorized Signatory
            </div>
        </div>
    </div>
</div>

<script>
    let lastId = parseInt(localStorage.getItem('ccs_id_v4')) || 1001;
    
    function updateHeader() {
        document.getElementById("invoiceIdDisplay").innerText = "#CCS-" + lastId;
        document.getElementById("currentDate").innerText = new Date().toLocaleString('en-GB', { day:'2-digit', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit'});
    }

    function addRow() {
        const tb = document.getElementById("itemsBody");
        const sr = tb.children.length + 1;
        const tr = document.createElement("tr");
        tr.style.borderBottom = "1px solid #f1f5f9";
        tr.innerHTML = `
            <td class="fw-bold text-muted pt-3">${sr}</td>
            <td class="pt-2"><input class="form-control form-control-sm border-0 bg-transparent" placeholder="..."></td>
            <td class="pt-2"><input type="number" class="form-control form-control-sm text-center border-0 bg-transparent" value="1" oninput="calculate()"></td>
            <td class="pt-2"><input type="number" class="form-control form-control-sm text-end border-0 bg-transparent" value="0" oninput="calculate()"></td>
            <td class="text-end fw-bold pt-3" id="rowTotal">₹0.00</td>
        `;
        tb.appendChild(tr);
    }

    function calculate() {
        let sub = 0;
        document.querySelectorAll("#itemsBody tr").forEach(row => {
            const qty = parseFloat(row.cells[2].querySelector('input').value) || 0;
            const rate = parseFloat(row.cells[3].querySelector('input').value) || 0;
            const total = qty * rate;
            row.cells[4].innerText = "₹" + total.toLocaleString('en-IN', {minimumFractionDigits: 2});
            sub += total;
        });
        const gst = sub * 0.18;
        const grand = sub + gst;
        document.getElementById("subtotalDisplay").innerText = "₹" + sub.toLocaleString('en-IN', {minimumFractionDigits: 2});
        document.getElementById("taxDisplay").innerText = "₹" + gst.toLocaleString('en-IN', {minimumFractionDigits: 2});
        document.getElementById("grandTotalDisplay").innerText = "₹" + grand.toLocaleString('en-IN', {minimumFractionDigits: 2});
    }

    function finalizeAndSave() {
        const element = document.getElementById("printArea");
        html2pdf().set({
            margin: 0,
            filename: `CityCar_Invoice_${lastId}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 3, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        }).from(element).save().then(() => {
            lastId++;
            localStorage.setItem('ccs_id_v4', lastId);
            updateHeader();
        });
    }

    updateHeader();
    addRow();
</script>
</body>
</html>
